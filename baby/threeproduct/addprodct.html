<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>录入产品信息 - 婴幼儿产品销售管理系统</title>
    <link rel="stylesheet" href="../../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/layuimini.css" media="all">
    <style>
        body {
        			    background-color: #f9f5f7;
        			    padding: 20px;
        			}
        			.page-title {
        				color: #ff6b9a;
        				font-size: 20px;
        				margin-bottom: 20px;
        				font-weight: bold;
        			}
        
        			.required-mark::before {
        				/* 星号内容 */
        				content: "*";
        				/* 红色 */
        				color: #ff0000;
        				/* 与文字保持一点距离 */
        				margin-right: 4px;
        				/* 星号加粗 */
        				font-weight: bold;
        
        			}
        
        			.layui-form-label {
        				margin-left: 30px;
        				width: 150px;
        				/* 加宽label，足够放下长标题（如“近期成长变化”） */
        				min-width: 150px;
        				/* 防止宽度被压缩 */
        				text-align: left;
        				padding-right: 0;
        
        				line-height: 38px !important;
        				/* 与输入框高度对齐 */
        			}
        
        			.layui-form-item {
						
        				margin-bottom: 6px;
        				display: flex;
        				/* 确保label和输入区水平排列 */
        				align-items: flex-start;
        				/* 顶部对齐，避免内容错位 */
        			}
        
        			.layui-input-block {
        				padding-top: 9px;
        				width: 70%;
        				text-align: left;
        				margin-left: 30px;
        			}
        
        			.form-tips {
        				color: lightpink;
        				font-size: 2px;
        				margin-top: 5px;
        				line-height: 1.5;
        			}
        
        			.form-container {
        				background: white;
        				padding: 25px;
        				margin-left: 30px;
        				margin-right: 30px;
        				border-radius: 10px;
        				box-shadow: 0 2px 10px rgba(255, 107, 154, 0.1);
        			}
        
        			
        			.form-section-title {
        				color: #ff6b9a;
        				margin-bottom: 15px;
        				font-weight: 600;
        				font-size: 16px;
        				padding-left: 5px;
        				border-left: 3px solid #ff6b9a;
        			}
        			.form-section {
        			    margin-bottom: 30px;
        			    padding-bottom: 20px;
        			    border-bottom: 1px dashed #ffccd5;
        			}
        			.layui-btn-normal {
        			    background-color: #ff6b9a;
        			    border-color: #ff6b9a;
        			}
        			.layui-btn-primary {
        			    border-color: #ffccd5;
        			}
        			.layui-btn-normal:hover {
        			    background-color: #ff4988;
        			}
					#but{
						margin-left: 30px;
					}
					
    </style>
</head>
<body>
    <div class="page-title">
        <i class="layui-icon layui-icon-add-circle" style="margin-right: 20px;"></i> 产品信息管理
		
			<button class="layui-btn layui-btn-normal" style="margin-left: 30px;" lay-submit>添加产品</button>
		    <button class="layui-btn layui-btn-normal" lay-submit>修改产品</button>
		    <button class="layui-btn layui-btn-normal" lay-submit>查询产品</button>
		
		
		
    </div>

    <div class="form-container">
        <form class="layui-form" lay-filter="productForm">
            <!-- 基本信息 section -->
            <div class="form-section">
                <div class="form-section-title">基本信息</div>
                
                <div class="layui-form-item">
                    <label class="layui-form-label required-mark">产品名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="productName" lay-verify="required" placeholder="请输入产品名称" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label required-mark">产品编码</label>
                    <div class="layui-input-block">
                        <input type="text" name="productCode" lay-verify="required" placeholder="请输入产品编码" autocomplete="off" class="layui-input">
                        <p class="form-tips" style="color: lightpink; font-size: 12px; margin-top: 5px; line-height: 1.5;">编码唯一，用于产品识别</p>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label required-mark">所属分类</label>
                    <div class="layui-input-block">
                        <select name="categoryId" lay-verify="required" lay-search>
                            <option value="">请选择产品分类</option>
                            <!-- 动态加载分类 -->
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label required-mark">品牌</label>
                    <div class="layui-input-block">
                        <input type="text" name="brand" lay-verify="required" placeholder="请输入品牌名称" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">产品标签</label>
                    <div class="layui-input-block">
                        <input type="text" name="tags" placeholder="多个标签用逗号分隔，如：有机,天然,无刺激" autocomplete="off" class="layui-input">
                    </div>
                </div>
				
            </div>

            <!-- 规格信息 section -->
            <div class="form-section">
                <div class="form-section-title">规格信息</div>
                
                <div class="layui-form-item">
                    <label class="layui-form-label required-mark">销售价（元）</label>
                    <div class="layui-input-block">
                        <input type="number" step="0.01" min="0" name="price" lay-verify="required|number" placeholder="请输入销售价" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label required-mark">成本价（元）</label>
                    <div class="layui-input-block">
                        <input type="number" step="0.01" min="0" name="costPrice" lay-verify="required|number" placeholder="请输入成本价" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label required-mark">库存数量</label>
                    <div class="layui-input-block">
                        <input type="number" min="0" name="stock" lay-verify="required|number" placeholder="请输入库存数量" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">规格参数</label>
                    <div class="layui-input-block">
                        <table class="spec-table" id="specTable">
                            <thead>
                                <tr>
                                    <th width="30%">规格名称</th>
                                    <th width="30%">规格值</th>
                                    <th width="30%">单位</th>
                                    
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><input type="text" name="specName[]" class="layui-input" placeholder="如：重量"></td>
                                    <td><input type="text" name="specValue[]" class="layui-input" placeholder="如：500"></td>
                                    <td><input type="text" name="specUnit[]" class="layui-input" placeholder="如：g"></td>
                                    
                                </tr>
                            </tbody>
                        </table>
                        <div class="but" style="margin-top: 10px;">
                            
                                <button class="layui-btn layui-btn-normal" lay-submit>添加规格</button>
                                <button type="button" class="layui-btn layui-btn-primary" >删除规格</button>
                            
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">适用年龄</label>
                    <div class="layui-input-block">
                        <select name="suitableAge">
                            <option value="">请选择适用年龄</option>
                            <option value="0-6m">0-6个月</option>
                            <option value="6-12m">6-12个月</option>
                            <option value="1-3y">1-3岁</option>
                            <option value="3-6y">3-6岁</option>
                            <option value="all">全年龄段</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 产品图片 section -->
            <div class="form-section">
                <div class="form-section-title">产品图片</div>
                
                <div class="layui-form-item">
                    <label class="layui-form-label required-mark">主图</label>
                    <div class="layui-input-block">
                        <button type="button" class="layui-btn" id="uploadMainImg">
                            <i class="layui-icon layui-icon-upload"></i> 上传主图
                        </button>
                        <input type="hidden" name="mainImage">
                        <div class="upload-img-box" id="mainImgBox">
                            <div class="upload-img-item">
                                <i class="layui-icon layui-icon-picture" style="font-size: 24px; color: #ccc;"></i>
                            </div>
                        </div>
						<p class="form-tips" style="color: lightpink; font-size: 12px; margin-top: 5px; line-height: 1.5;">建议尺寸：800*800px，支持jpg、png格式</p>
                       
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">详情图</label>
                    <div class="layui-input-block">
                        <button type="button" class="layui-btn" id="uploadDetailImg">
                            <i class="layui-icon layui-icon-upload"></i> 上传详情图
                        </button>
                        <input type="hidden" name="detailImages">
                        <div class="upload-img-box" id="detailImgBox">
                            <div class="upload-img-item">
                                <i class="layui-icon layui-icon-picture" style="font-size: 24px; color: #ccc;"></i>
                            </div>
                        </div>
						<p class="form-tips" style="color: lightpink; font-size: 12px; margin-top: 5px; line-height: 1.5;">最多上传5张，建议尺寸：800*800px，支持jpg、png格式</p>
                       
                    </div>
                </div>
            </div>

            <!-- 产品详情 section -->
            <div class="form-section">
                <div class="form-section-title">产品详情</div>
                
                <div class="layui-form-item">
                    <label class="layui-form-label">产品描述</label>
                    <div class="layui-input-block">
                        <textarea name="description" placeholder="请输入产品详细描述" class="layui-textarea" rows="5"></textarea>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">产品特点</label>
                    <div class="layui-input-block">
                        <textarea name="features" placeholder="请输入产品特点，每行一个特点" class="layui-textarea" rows="5"></textarea>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">注意事项</label>
                    <div class="layui-input-block">
                        <textarea name="notes" placeholder="请输入使用注意事项" class="layui-textarea" rows="3"></textarea>
                    </div>
                </div>
            </div>

            <!-- 状态设置 section -->
            <div class="form-section">
                <div class="form-section-title">状态设置</div>
                
                <div class="layui-form-item">
                    <label class="layui-form-label required-mark">上架状态</label>
                    <div class="layui-input-block">
                        <input type="radio" name="status" value="1" title="上架" checked>
                        <input type="radio" name="status" value="0" title="下架">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">是否推荐</label>
                    <div class="layui-input-block">
                        <input type="radio" name="isRecommend" value="1" title="是">
                        <input type="radio" name="isRecommend" value="0" title="否" checked>
                    </div>
                </div>
            </div>

            <!-- 操作按钮 -->
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn layui-btn-normal" lay-submit>保存产品</button>
                    <button type="button" class="layui-btn layui-btn-primary" onclick="window.location.href='product-list.html'">返回列表</button>
                </div>
            </div>
        </form>
    </div>

    <script src="../../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
    <script>
        layui.use(['form', 'layer', 'upload', 'jquery'], function() {
            var form = layui.form;
            var layer = layui.layer;
            var upload = layui.upload;
            var $ = layui.jquery;

            // 加载产品分类
            function loadCategories() {
                $.getJSON('categoryData.json', function(res) {
                    if (res.code === 0) {
                        var categories = res.data;
                        var html = '<option value="">请选择产品分类</option>';
                        html += buildOptions(categories);
                        $('select[name="categoryId"]').html(html);
                        form.render('select');
                    }
                });
            }

            // 初始化上传组件 - 主图
            var uploadMainImg = upload.render({
                elem: '#uploadMainImg',
                url: '/api/upload/image', // 实际项目中替换为后端上传接口
                accept: 'images',
                acceptMime: 'image/jpg, image/png, image/jpeg',
                exts: 'jpg|png|jpeg',
                before: function(obj) {
                    layer.load(1);
                },
                done: function(res) {
                    layer.closeAll('loading');
                    if (res.code === 0) {
                        // 上传成功，显示图片
                        $('#mainImgBox').html(`
                            <div class="upload-img-item">
                                <img src="${res.data.src}" alt="产品主图">
                                <span class="del-img" onclick="deleteImg('mainImage', this)"><i class="layui-icon layui-icon-close"></i></span>
                            </div>
                        `);
                        $('input[name="mainImage"]').val(res.data.src);
                    } else {
                        layer.msg('上传失败：' + res.msg, {icon: 2});
                    }
                },
                error: function() {
                    layer.closeAll('loading');
                    layer.msg('上传失败，请重试', {icon: 2});
                }
            });

            // 初始化上传组件 - 详情图
            var uploadDetailImg = upload.render({
                elem: '#uploadDetailImg',
                url: '/api/upload/image', // 实际项目中替换为后端上传接口
                accept: 'images',
                acceptMime: 'image/jpg, image/png, image/jpeg',
                exts: 'jpg|png|jpeg',
                multiple: true,
                number: 5,
                before: function(obj) {
                    layer.load(1);
                },
                done: function(res) {
                    layer.closeAll('loading');
                    if (res.code === 0) {
                        // 检查当前图片数量
                        var currentCount = $('#detailImgBox .upload-img-item').length;
                        if (currentCount >= 5) {
                            layer.msg('最多只能上传5张图片', {icon: 2});
                            return;
                        }
                        
                        // 添加新图片
                        var imgHtml = `
                            <div class="upload-img-item">
                                <img src="${res.data.src}" alt="产品详情图">
                                <span class="del-img" onclick="deleteImg('detailImages', this)"><i class="layui-icon layui-icon-close"></i></span>
                            </div>
                        `;
                        $('#detailImgBox').append(imgHtml);
                        
                        // 更新隐藏域的值
                        updateDetailImagesValue();
                    } else {
                        layer.msg('上传失败：' + res.msg, {icon: 2});
                    }
                },
                error: function() {
                    layer.closeAll('loading');
                    layer.msg('上传失败，请重试', {icon: 2});
                }
            });

            // 更新详情图隐藏域的值
            function updateDetailImagesValue() {
                var imgSrcs = [];
                $('#detailImgBox img').each(function() {
                    imgSrcs.push($(this).attr('src'));
                });
                $('input[name="detailImages"]').val(imgSrcs.join(','));
            }

            // 删除图片
            window.deleteImg = function(type, elem) {
                $(elem).closest('.upload-img-item').remove();
                
                if (type === 'detailImages') {
                    updateDetailImagesValue();
                } else if (type === 'mainImage') {
                    $('#mainImgBox').html(`
                        <div class="upload-img-item">
                            <i class="layui-icon layui-icon-picture" style="font-size: 24px; color: #ccc;"></i>
                        </div>
                    `);
                    $('input[name="mainImage"]').val('');
                }
            };

            // 添加规格行
            $('#addSpecBtn').click(function() {
                var trHtml = `
                    <tr>
                        <td><input type="text" name="specName[]" class="layui-input" placeholder="如：重量"></td>
                        <td><input type="text" name="specValue[]" class="layui-input" placeholder="如：500"></td>
                        <td><input type="text" name="specUnit[]" class="layui-input" placeholder="如：g"></td>
                        <td><button type="button" class="layui-btn layui-btn-danger layui-btn-xs del-spec"><i class="layui-icon layui-icon-delete"></i></button></td>
                    </tr>
                `;
                $('#specTable tbody').append(trHtml);
                
                // 绑定删除事件
                bindDelSpecEvent();
            });

            // 绑定删除规格行事件
            function bindDelSpecEvent() {
                $('.del-spec').off('click').on('click', function() {
                    var trCount = $('#specTable tbody tr').length;
                    if (trCount <= 1) {
                        layer.msg('至少保留一条规格信息', {icon: 2});
                        return;
                    }
                    $(this).closest('tr').remove();
                });
            }

            // 表单提交
            form.on('submit(productForm)', function(data) {
                // 验证主图是否上传
                if (!data.field.mainImage) {
                    layer.msg('请上传产品主图', {icon: 2});
                    return false;
                }
                
                // 模拟提交
                layer.load(1);
                setTimeout(function() {
                    layer.closeAll('loading');
                    layer.msg('产品信息保存成功！', {icon: 1}, function() {
                        window.location.href = 'product-list.html';
                    });
                }, 1000);
                
                return false;
            });

            // 页面初始化
            $(function() {
                loadCategories();
                bindDelSpecEvent();
            });
        });
    </script>
</body>
</html>
