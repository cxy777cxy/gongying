<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>用户信息 - 婴幼儿产品销售管理系统</title>
    <!-- Layui 样式引用 -->
    <link rel="stylesheet" href="../../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/layuimini.css" media="all">
    <style>
        body {
            background-color: #f9f5f7;
            padding: 20px;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .page-title {
            color: #ff6b9a;
            font-size: 20px;
            font-weight: bold;
        }
        .table-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(255,107,154,0.1);
            margin-bottom: 20px;
        }
        /* 搜索区域样式 */
        .search-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(255,107,154,0.1);
            margin-bottom: 20px;
        }
        .search-fieldset {
            border: 1px solid #f2f2f2;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 0;
        }
        .search-legend {
            color: #ff6b9a;
            font-weight: 600;
            padding: 0 10px;
        }
        /* 按钮样式统一（粉色主题） */
        .layui-btn-normal {
            background-color: #ff6b9a;
            border-color: #ff6b9a;
        }
        .layui-btn-normal:hover {
            background-color: #ff4988;
        }
        .layui-btn-danger {
            background-color: #ff8a80;
            border-color: #ff8a80;
        }
        .layui-btn-danger:hover {
            background-color: #ff5252;
        }
        .layui-btn-primary {
            background-color: #f8f9fa;
            border-color: #e9ecef;
            color: #495057;
        }
        .layui-btn-primary:hover {
            background-color: #e2e6ea;
            border-color: #dae0e5;
        }
        /* 状态标签样式 */
        .status-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        .status-enabled {
            background-color: #e8f5e9;
            color: #4caf50;
        }
        .status-disabled {
            background-color: #ffebee;
            color: #f44336;
        }
        /* 表格工具栏样式 */
        .table-toolbar {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>
    <!-- 页面头部：标题 + 批量操作 -->
    <div class="page-header">
        <div class="page-title">
            <i class="layui-icon layui-icon-user"></i> 用户信息管理
        </div>
        <div class="table-toolbar">
            <button class="layui-btn layui-btn-normal" lay-event="add">
                <i class="layui-icon layui-icon-plus"></i> 添加用户
            </button>
            <button class="layui-btn layui-btn-danger" lay-event="batchDelete">
                <i class="layui-icon layui-icon-delete"></i> 批量删除
            </button>
        </div>
    </div>

    <!-- 搜索区域 -->
    <div class="search-container">
        <fieldset class="search-fieldset" id="searchFieldset">
            <legend class="search-legend">搜索信息</legend>
            <form class="layui-form layui-form-pane" action="" lay-filter="searchForm">
                <div class="layui-row layui-col-space20">
                    <!-- 第一行搜索条件 -->
                    <div class="layui-form-item layui-col-space15">
                        <div class="layui-inline">
                            <label class="layui-form-label">用户名</label>
                            <div class="layui-input-inline">
                                <input type="text" name="realName" placeholder="请输入用户名" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">电话号</label>
                            <div class="layui-input-inline">
                                <input type="text" name="phone" placeholder="请输入电话号" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">用户角色</label>
                            <div class="layui-input-inline">
                                <select name="role" lay-search>
                                    <option value="">全部角色</option>
                                    <option value="1">系统管理员</option>
                                    <option value="2">销售人员</option>
                                    <option value="3">库存管理员</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <!-- 第二行搜索条件 + 按钮 -->
                    <div class="layui-form-item layui-col-space15">
                        <div class="layui-inline">
                            <label class="layui-form-label">会员等级</label>
                            <div class="layui-input-inline">
                                <select name="level" lay-search>
                                    <option value="">全部等级</option>
                                    <option value="1">普通会员</option>
                                    <option value="2">高级会员</option>
                                    <option value="3">钻石会员</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <!-- 搜索按钮 -->
                            <button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="searchBtn">
                                <i class="layui-icon layui-icon-search"></i> 搜索用户
                            </button>
                            <!-- 重置按钮 -->
                            <button type="button" class="layui-btn layui-btn-primary" id="resetBtn">
                                <i class="layui-icon layui-icon-refresh"></i> 重置
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </fieldset>
    </div>

    <!-- 表格容器：只保留空的 <table>，表头由 Layui 自动渲染 -->
    <div class="table-container">
        <table class="layui-table" id="userTable" lay-size="sm"></table>
    </div>

    <!-- Layui JS 引用 -->
    <script src="../../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
    <script>
        layui.use(['table', 'layer', 'form', 'jquery'], function() {
            var table = layui.table;
            var layer = layui.layer;
            var form = layui.form;
            var $ = layui.jquery;

            // 1. 渲染用户表格（只渲染一次，由 Layui 自动生成表头）
            var tableIns = table.render({
                elem: '#userTable',
                url: 'user.json', // 实际项目请求后端接口
                page: true, // 开启分页
                limit: 10, // 每页默认10条
                limits: [5, 10, 15, 20],
                cols: [[
                    {type: 'checkbox', fixed: 'left'}, // 复选框
                    {field: 'userId', title: '用户ID', fixed: 'left', sort: true},
                    {field: 'username', title: '用户名'},
                    {field: 'phone', title: '手机号'},
                    {field: 'role', title: '角色', templet: function(d) {
                        // 角色值转文字（匹配下拉框选项）
                        var roleMap = {1: '系统管理员', 2: '销售人员', 3: '库存管理员'};
                        return roleMap[d.role] || '未知角色';
                    }},
                    {field: 'level', title: '会员等级', templet: function(d) {
                        // 会员等级值转文字
                        var levelMap = {1: '普通会员', 2: '高级会员', 3: '钻石会员'};
                        return levelMap[d.level] || '普通会员';
                    }},
                    {field: 'status', title: '状态', templet: function(d) {
                        // 自定义状态标签
                        return d.status === 1 
                            ? '<span class="status-tag status-enabled">启用</span>' 
                            : '<span class="status-tag status-disabled">禁用</span>';
                    }},
                    {field: 'createTime', title: '创建时间', sort: true},
                    {fixed: 'right', title: '操作', toolbar: '#operateBar', width: 240} // 操作栏
                ]],
                done: function() {
                    // 表格渲染完成后初始化表单（确保状态切换按钮正常）
                    form.render();
                }
            });

            // 2. 搜索按钮监听
            form.on('submit(searchBtn)', function(data) {
                // 执行表格重载（带搜索参数）
                tableIns.reload({
                    page: {curr: 1}, // 重置到第1页
                    where: data.field // 搜索参数（用户名、手机号等）
                });
                return false; // 阻止表单默认提交
            });

            // 3. 重置按钮监听
            $('#resetBtn').on('click', function() {
                // 重置表单
                form.val('searchForm', {
                    realName: '',
                    phone: '',
                    role: '',
                    level: ''
                });
                // 重载表格（清空搜索条件）
                tableIns.reload({
                    page: {curr: 1},
                    where: {}
                });
            });

            // 4. 批量操作（添加/批量删除）
            $('[lay-event="add"]').on('click', function() {
                // 打开添加用户弹窗
                var index = layer.open({
                    title: '添加用户',
                    type: 2,
                    shade: 0.2,
                    maxmin: true,
                    shadeClose: true,
                    area: ['80%', '90%'],
                    content: './user/addUser.html'
                });
                $(window).on('resize', function() {
                    layer.full(index);
                });
            });

            $('[lay-event="batchDelete"]').on('click', function() {
                // 获取选中的行
                var checkStatus = table.checkStatus('userTable');
                var dataList = checkStatus.data;

                if (dataList.length === 0) {
                    layer.msg('请选择要删除的用户！', {icon: 3});
                    return;
                }

                // 批量删除确认
                layer.confirm('确定要删除选中的 ' + dataList.length + ' 个用户吗？删除后不可恢复！', {
                    icon: 2,
                    title: '警告'
                }, function(index) {
                    // 模拟后端删除接口请求
                    layer.load(1);
                    setTimeout(function() {
                        // 重载表格（实际项目删除成功后刷新数据）
                        tableIns.reload();
                        layer.closeAll('loading');
                        layer.msg('选中用户已删除！', {icon: 1});
                    }, 800);
                    layer.close(index);
                });
            });

            // 5. 行操作监听（查看详情/修改/删除/状态切换）
            table.on('tool(userTable)', function(obj) {
                var data = obj.data; // 当前行数据
                var layEvent = obj.event; // 事件类型

                // 查看详情
                if (layEvent === 'detail') {
                    var index = layer.open({
                        title: '用户详情',
                        type: 2,
                        shade: 0.2,
                        maxmin: true,
                        shadeClose: true,
                        area: ['80%', '90%'],
                        content: './user/userDetail.html?userId=' + data.userId // 携带用户ID
                    });
                    $(window).on('resize', function() {
                        layer.full(index);
                    });
                }

                // 修改用户
                else if (layEvent === 'edit') {
                    var index = layer.open({
                        title: '编辑用户',
                        type: 2,
                        shade: 0.2,
                        maxmin: true,
                        shadeClose: true,
                        area: ['80%', '90%'],
                        content: './user/editUser.html?userId=' + data.userId // 携带用户ID
                    });
                    $(window).on('resize', function() {
                        layer.full(index);
                    });
                }

                // 删除用户
                else if (layEvent === 'delete') {
                    layer.confirm('确定要删除该用户吗？删除后不可恢复！', {
                        icon: 2,
                        title: '警告'
                    }, function(index) {
                        // 模拟后端删除接口请求
                        layer.load(1);
                        setTimeout(function() {
                            obj.del(); // 从表格中移除当前行
                            layer.closeAll('loading');
                            layer.msg('用户已删除！', {icon: 1});
                        }, 800);
                        layer.close(index);
                    });
                }

                // 状态切换（启用/禁用）
                else if (layEvent === 'toggleStatus') {
                    var newStatus = data.status === 1 ? 0 : 1;
                    var statusText = newStatus === 1 ? '启用' : '禁用';

                    layer.confirm('确定要' + statusText + '该用户吗？', {
                        icon: 3,
                        title: '提示'
                    }, function(index) {
                        // 模拟后端更新状态接口请求
                        layer.load(1);
                        setTimeout(function() {
                            obj.update({status: newStatus}); // 局部更新表格状态
                            layer.closeAll('loading');
                            layer.msg('用户已' + statusText + '！', {icon: 1});
                        }, 800);
                        layer.close(index);
                    });
                }
            });

            // 6. 表格复选框选择监听（可选，用于调试）
            table.on('checkbox(userTable)', function(obj) {
                console.log('选中状态：', obj.checked);
                console.log('当前行数据：', obj.data);
            });
        });
    </script>

    <!-- 操作栏模板（需放在 JS 之前） -->
    <script type="text/html" id="operateBar">
        <button class="layui-btn layui-btn-xs layui-btn-primary" lay-event="detail">
            <i class="layui-icon layui-icon-eye"></i> 查看详情
        </button>
        <button class="layui-btn layui-btn-xs layui-btn-normal" lay-event="edit">
            <i class="layui-icon layui-icon-edit"></i> 修改
        </button>
        {{#  if(d.status === 0){ }}
            <button class="layui-btn layui-btn-xs layui-btn-normal" lay-event="toggleStatus">
                <i class="layui-icon layui-icon-play"></i> 启用
            </button>
        {{#  } else { }}
            <button class="layui-btn layui-btn-xs layui-btn-primary" lay-event="toggleStatus">
                <i class="layui-icon layui-icon-pause"></i> 禁用
            </button>
        {{#  } }}
        <button class="layui-btn layui-btn-xs layui-btn-danger" lay-event="delete">
            <i class="layui-icon layui-icon-delete"></i> 删除
        </button>
    </script>
</body>
</html