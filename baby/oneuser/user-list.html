<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>用户列表（删除/禁用） - 婴幼儿产品销售管理系统</title>
    <!-- Layui 样式引用 -->
    <link rel="stylesheet" href="../../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/layuimini.css" media="all">
    <style>
        body {
            background-color: #f9f5f7;
            padding: 20px;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .page-title {
            color: #ff6b9a;
            font-size: 20px;
            font-weight: bold;
        }
        .table-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(255,107,154,0.1);
        }
        .layui-btn-normal {
            background-color: #ff6b9a;
            border-color: #ff6b9a;
        }
        .layui-btn-normal:hover {
            background-color: #ff4988;
        }
        .layui-btn-danger {
            background-color: #ff8a80;
            border-color: #ff8a80;
        }
        .layui-btn-danger:hover {
            background-color: #ff5252;
        }
        /* 状态标签样式 */
        .status-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        .status-enabled {
            background-color: #e8f5e9;
            color: #4caf50;
        }
        .status-disabled {
            background-color: #ffebee;
            color: #f44336;
        }
        /* 表格工具栏样式 */
        .table-toolbar {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>
    <!-- 页面头部：标题 + 批量操作 -->
    <div class="page-header">
        <div class="page-title">
            <i class="layui-icon layui-icon-user"></i> 用户列表（删除/禁用）
        </div>
        <div class="table-toolbar">
            <button class="layui-btn layui-btn-normal" onclick="window.location.href='add-user.html'">
                <i class="layui-icon layui-icon-plus"></i> 添加用户
            </button>
            <button class="layui-btn layui-btn-danger" lay-event="batchDelete">
                <i class="layui-icon layui-icon-delete"></i> 批量删除
            </button>
        </div>
    </div>

    <!-- 表格容器：只保留表格元素，表头由Layui渲染 -->
    <div class="table-container">
        <table class="layui-table" id="userTable" lay-size="sm"></table>
    </div>

    <!-- Layui JS 引用 -->
    <script src="../../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
    <script>
        layui.use(['table', 'layer', 'form', 'jquery'], function() {
            var table = layui.table;
            var layer = layui.layer;
            var form = layui.form;
            var $ = layui.jquery;

            // 渲染用户表格
            table.render({
                elem: '#userTable',
                data: [
                    {userId: 1001, username: 'sales001', phone: '13800138000', role: '销售人员', status: 1, createTime: '2024-01-15'},
                    {userId: 1002, username: 'admin001', phone: '13900139000', role: '系统管理员', status: 1, createTime: '2024-01-10'},
                    {userId: 1003, username: 'stock001', phone: '13700137000', role: '库存管理员', status: 0, createTime: '2024-01-20'},
                    {userId: 1004, username: 'sales002', phone: '13600136000', role: '销售人员', status: 1, createTime: '2024-02-05'}
                ], // 模拟后端数据
                page: true, // 开启分页
                limit: 10, // 每页默认10条
                limits: [5, 10, 15],
                cols: [[
                    {type: 'checkbox', fixed: 'left'},
                    {field: 'userId', title: '用户ID', fixed: 'left', sort: true},
                    {field: 'username', title: '用户名'},
                    {field: 'phone', title: '手机号'},
                    {field: 'role', title: '角色'},
                    {field: 'status', title: '状态', templet: function(d) {
                        // 自定义状态标签
                        return d.status === 1 
                            ? '<span class="status-tag status-enabled">启用</span>' 
                            : '<span class="status-tag status-disabled">禁用</span>';
                    }},
                    {field: 'createTime', title: '创建时间', sort: true},
                    {fixed: 'right', title: '操作', toolbar: '#operateBar', width: 220}
                ]],
                done: function() {
                    // 表格渲染完成后初始化表单
                    form.render();
                }
            });

            // 批量删除功能
            $('[lay-event="batchDelete"]').on('click', function() {
                var checkStatus = table.checkStatus('userTable');
                var data = checkStatus.data;

                if (data.length === 0) {
                    layer.msg('请选择要删除的用户！', {icon: 3});
                    return;
                }

                layer.confirm('确定要删除选中的' + data.length + '个用户吗？', {icon: 2, title: '警告'}, function(index) {
                    // 模拟批量删除接口请求
                    layer.load(1);
                    setTimeout(function() {
                        table.reload('userTable'); // 重新加载表格
                        layer.closeAll('loading');
                        layer.msg('选中用户已删除！', {icon: 1});
                    }, 1000);
                    layer.close(index);
                });
            });

            // 操作栏事件监听
            table.on('tool(userTable)', function(obj) {
                var data = obj.data; // 当前行数据
                var layEvent = obj.event; // 事件类型

                // 1. 启用/禁用用户
                if (layEvent === 'enable' || layEvent === 'disabled') {
                    var newStatus = layEvent === 'enable' ? 1 : 0;
                    var statusText = newStatus === 1 ? '启用' : '禁用';

                    layer.confirm('确定要' + statusText + '该用户吗？', {icon: 3, title: '提示'}, function(index) {
                        // 模拟接口请求：更新用户状态
                        layer.load(1);
                        setTimeout(function() {
                            obj.update({status: newStatus}); // 局部更新表格数据
                            layer.closeAll('loading');
                            layer.msg('用户已' + statusText + '！', {icon: 1});
                        }, 800);
                        layer.close(index);
                    });
                }

                // 2. 修改用户信息
                else if (layEvent === 'edit') {
                    // 跳转至修改页面，并携带用户ID
                    window.location.href = 'edit-user.html?userId=' + data.userId;
                }

                // 3. 删除用户
                else if (layEvent === 'delete') {
                    layer.confirm('确定要删除该用户吗？删除后不可恢复！', {icon: 2, title: '警告'}, function(index) {
                        // 模拟接口请求：删除用户
                        layer.load(1);
                        setTimeout(function() {
                            obj.del(); // 从表格中删除当前行
                            layer.closeAll('loading');
                            layer.msg('用户已删除！', {icon: 1});
                        }, 800);
                        layer.close(index);
                    });
                }
            });
        });
    </script>

    <!-- 操作栏模板 -->
    <script type="text/html" id="operateBar">
        {{#  if(d.status === 0){ }}
            <button class="layui-btn layui-btn-xs layui-btn-normal" lay-event="enable">启用</button>
        {{#  } else { }}
            <button class="layui-btn layui-btn-xs layui-btn-primary" lay-event="disabled">禁用</button>
        {{#  } }}
        <button class="layui-btn layui-btn-xs layui-btn-normal" lay-event="edit">修改</button>
        <button class="layui-btn layui-btn-xs layui-btn-danger" lay-event="delete">删除</button>
    </script>
</body>
</html>
